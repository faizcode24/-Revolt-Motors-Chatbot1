<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rev - Revolt Motors Chatbot</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
  <link rel="icon" href="/assets/favicon.ico">
  <style>
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #f5f7fa 0%, #e0e7ff 100%);
      color: #1a1a2e;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      overflow-x: hidden;
      transition: background 0.5s ease, color 0.5s ease;
    }

    body.dark {
      background: linear-gradient(135deg, #1a1a2e 0%, #2c2c3e 100%);
      color: #e0e0e0;
    }

    .welcome-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 48, 135, 0.95);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      z-index: 1000;
      animation: fadeOut 2s ease-in-out 2s forwards;
    }

    .welcome-logo {
      width: 100px;
      animation: bounce 1s ease-in-out;
    }

    .welcome-overlay h2 {
      font-size: 2.5rem;
      font-weight: 900;
      margin: 0.5rem 0;
    }

    .welcome-overlay p {
      font-size: 1.2rem;
      opacity: 0.8;
    }

    #background-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      opacity: 0.15;
    }

    .header {
      background: rgba(0, 48, 135, 0.85);
      backdrop-filter: blur(12px);
      color: white;
      text-align: center;
      padding: 1.8rem;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      z-index: 10;
    }

    .logo {
      width: 70px;
      height: auto;
      margin-right: 1.2rem;
      transition: transform 0.3s ease;
    }

    .logo:hover {
      transform: scale(1.1);
    }

    h1 {
      font-size: 2.2rem;
      font-weight: 900;
      margin: 0;
    }

    #theme-toggle {
      background: none;
      border: none;
      font-size: 1.8rem;
      cursor: pointer;
      position: absolute;
      right: 1.5rem;
      color: white;
      transition: transform 0.5s ease, color 0.3s ease;
    }

    #theme-toggle:hover {
      transform: rotate(360deg);
      color: #00ff85;
    }

    [data-tooltip] {
      position: relative;
    }

    [data-tooltip]:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      top: -2.5rem;
      right: 0;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      font-size: 0.9rem;
      white-space: nowrap;
      z-index: 10;
      animation: fadeIn 0.3s ease-in;
    }

    .container {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2.5rem;
      max-width: 800px;
      margin: 0 auto;
    }

    #chat-box {
      width: 100%;
      height: 500px;
      background: #e0e7ff;
      border-radius: 20px;
      box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.2), -5px -5px 15px rgba(255, 255, 255, 0.8);
      overflow-y: auto;
      padding: 2rem;
      margin-bottom: 2.5rem;
      position: relative;
      transition: background 0.3s ease;
    }

    body.dark #chat-box {
      background: #2c2c3e;
      box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.4), -5px -5px 15px rgba(60, 60, 80, 0.6);
    }

    #chat-box::-webkit-scrollbar {
      width: 12px;
    }

    #chat-box::-webkit-scrollbar-track {
      background: transparent;
    }

    #chat-box::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #0059ff, #00ff85);
      border-radius: 6px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
    }

    .message {
      margin: 1rem 0;
      padding: 1.2rem 1.8rem;
      border-radius: 15px;
      max-width: 70%;
      position: relative;
      background: #ffffff;
      box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.15), -3px -3px 8px rgba(255, 255, 255, 0.7);
      transform: perspective(500px) rotateY(0deg);
      transition: all 0.3s ease;
    }

    .message:hover {
      transform: perspective(500px) rotateY(5deg);
      box-shadow: 5px 5px 12px rgba(0, 0, 0, 0.2), -5px -5px 12px rgba(255, 255, 255, 0.9);
    }

    .message.ai {
      background: linear-gradient(135deg, #e0e7ff, #c3d7ff);
      color: #1a1a2e;
      margin-right: 3rem;
    }

    body.dark .message.ai {
      background: linear-gradient(135deg, #3a3a5a, #2c2c3e);
      color: #e0e0e0;
    }

    .message.user {
      background: linear-gradient(135deg, #0059ff, #00ff85);
      color: white;
      margin-left: auto;
      margin-left: 3rem;
    }

    .message.system {
      background: linear-gradient(135deg, #ffe8e8, #ffcccc);
      color: #d32f2f;
      text-align: center;
      max-width: 80%;
      margin: 1rem auto;
    }

    body.dark .message.system {
      background: linear-gradient(135deg, #5a2e2e, #3f1e1e);
      color: #ff9999;
    }

    .message .timestamp {
      font-size: 0.85rem;
      color: #666;
      margin-top: 0.6rem;
      opacity: 0.6;
      text-align: right;
    }

    body.dark .message .timestamp {
      color: #aaa;
    }

    .input-container {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      position: relative;
    }

    #mic-button {
      padding: 1.2rem 3rem;
      font-size: 1.3rem;
      font-weight: 700;
      background: linear-gradient(135deg, #003087, #0059ff);
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.2), -5px -5px 10px rgba(255, 255, 255, 0.7);
      transform: perspective(500px) rotateX(0deg);
      transition: all 0.3s ease;
    }

    #mic-button:hover {
      background: linear-gradient(135deg, #0041c2, #007bff);
      transform: perspective(500px) rotateX(5deg);
      box-shadow: 7px 7px 15px rgba(0, 0, 0, 0.3), -7px -7px 15px rgba(255, 255, 255, 0.9);
    }

    #mic-button.active {
      background: linear-gradient(135deg, #d32f2f, #ff4d4d);
      animation: glow 1.5s infinite;
    }

    .mic-animation {
      width: 50px;
      height: 25px;
      display: none;
      background: url('/assets/sound-wave.gif') no-repeat center;
      background-size: contain;
      filter: drop-shadow(0 0 5px rgba(0, 89, 255, 0.5));
    }

    .mic-animation.active {
      display: block;
      animation: wave 1s infinite;
    }

    .spinner {
      display: none;
      width: 30px;
      height: 30px;
      border: 4px solid #0059ff;
      border-top: 4px solid #00ff85;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    .spinner.active {
      display: block;
    }

    .footer {
      text-align: center;
      padding: 1.5rem;
      background: rgba(0, 0, 0, 0.1);
      color: #666;
      font-size: 1rem;
      box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.2);
    }

    body.dark .footer {
      background: rgba(255, 255, 255, 0.1);
      color: #aaa;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; display: none; }
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    @keyframes glow {
      0% { box-shadow: 0 0 10px rgba(0, 89, 255, 0.5); }
      50% { box-shadow: 0 0 20px rgba(0, 89, 255, 0.8); }
      100% { box-shadow: 0 0 10px rgba(0, 89, 255, 0.5); }
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes wave {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }

    @media (max-width: 768px) {
      .container {
        padding: 1.8rem;
      }
      #chat-box {
        height: 400px;
      }
      h1 {
        font-size: 1.8rem;
      }
      .logo {
        width: 50px;
      }
      .welcome-logo {
        width: 80px;
      }
    }

    @media (max-width: 480px) {
      #chat-box {
        height: 300px;
      }
      #mic-button {
        padding: 1rem 2rem;
        font-size: 1.1rem;
      }
      .welcome-overlay h2 {
        font-size: 2rem;
      }
      .welcome-overlay p {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="welcome-overlay">
    <img src="/assets/revolt-logo.png" alt="Revolt Motors Logo" class="welcome-logo">
    <h2>Welcome to Rev</h2>
    <p>Experience the future of mobility with Revolt Motors</p>
  </div>
  <canvas id="background-canvas"></canvas>
  <header class="header">
    <img src="/assets/revolt-logo.png" alt="Revolt Motors Logo" class="logo">
    <h1>Rev - Revolt Motors Chatbot</h1>
    <button id="theme-toggle" aria-label="Toggle dark/light mode" data-tooltip="Toggle Theme">🌙</button>
  </header>
  <div class="container">
    <div id="chat-box" aria-live="polite"></div>
    <div class="input-container">
      <button id="mic-button" aria-label="Start voice input" data-tooltip="Start/Stop Voice Input">Start Talking</button>
      <div id="mic-animation" class="mic-animation"></div>
      <div id="loading-spinner" class="spinner" aria-hidden="true"></div>
    </div>
  </div>
  <footer class="footer">
    <p>Powered by Revolt Motors &copy; 2025</p>
  </footer>
  <script>
    const ws = new WebSocket(`ws://${window.location.host}`);
    const chatBox = document.getElementById('chat-box');
    const micButton = document.getElementById('mic-button');
    const micAnimation = document.getElementById('mic-animation');
    const themeToggle = document.getElementById('theme-toggle');
    const spinner = document.getElementById('loading-spinner');
    let mediaRecorder;
    let isRecording = false;

    // Theme toggle
    const toggleTheme = () => {
      document.body.classList.toggle('dark');
      themeToggle.textContent = document.body.classList.contains('dark') ? '☀️' : '🌙';
      localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
    };

    // Load saved theme
    if (localStorage.getItem('theme') === 'dark') {
      document.body.classList.add('dark');
      themeToggle.textContent = '☀️';
    }

    themeToggle.addEventListener('click', toggleTheme);

    // Background animation
    const canvas = document.getElementById('background-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const particles = [];
    const particleCount = 100;

    class Particle {
      constructor() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.size = Math.random() * 4 + 1;
        this.speedX = Math.random() * 1.5 - 0.75;
        this.speedY = Math.random() * 1.5 - 0.75;
        this.opacity = Math.random() * 0.5 + 0.3;
      }
      update() {
        this.x += this.speedX;
        this.y += this.speedY;
        if (this.size > 0.2) this.size -= 0.03;
        if (this.x < 0 || this.x > canvas.width) this.speedX *= -1;
        if (this.y < 0 || this.y > canvas.height) this.speedY *= -1;
        if (this.size <= 0.2) {
          this.x = Math.random() * canvas.width;
          this.y = Math.random() * canvas.height;
          this.size = Math.random() * 4 + 1;
        }
      }
      draw() {
        ctx.fillStyle = document.body.classList.contains('dark') ? `rgba(102, 178, 255, ${this.opacity})` : `rgba(0, 89, 255, ${this.opacity})`;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function initParticles() {
      for (let i = 0; i < particleCount; i++) {
        particles.push(new Particle());
      }
    }

    function animateParticles() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      particles.forEach(particle => {
        particle.update();
        particle.draw();
      });
      requestAnimationFrame(animateParticles);
    }

    initParticles();
    animateParticles();

    window.addEventListener('resize', () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });

    // WebSocket handling
    ws.onopen = () => {
      console.log('Connected to WebSocket server');
      appendMessage('system', 'Connected! Ask about Revolt Motors.');
    };

    ws.onmessage = (event) => {
      spinner.classList.remove('active');
      const data = JSON.parse(event.data);
      if (data.type === 'response') {
        appendMessage('ai', data.data);
      } else if (data.type === 'error') {
        appendMessage('system', 'Error: ' + data.data);
      }
    };

    ws.onclose = () => {
      console.log('Disconnected from WebSocket server');
      appendMessage('system', 'Disconnected. Please refresh the page.');
    };

    micButton.addEventListener('click', async () => {
      if (!isRecording) {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          mediaRecorder = new MediaRecorder(stream);
          mediaRecorder.start();
          micButton.textContent = 'Stop Talking';
          micButton.classList.add('active');
          micAnimation.classList.add('active');
          isRecording = true;

          const audioChunks = [];
          mediaRecorder.ondataavailable = (event) => {
            audioChunks.push(event.data);
          };

          mediaRecorder.onstop = async () => {
            const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
            const reader = new FileReader();
            reader.readAsDataURL(audioBlob);
            reader.onloadend = () => {
              appendMessage('user', 'You said something...');
              spinner.classList.add('active');
              ws.send(JSON.stringify({ type: 'audio', data: reader.result }));
            };
            stream.getTracks().forEach(track => track.stop());
          };
        } catch (error) {
          console.error('Error accessing microphone:', error);
          appendMessage('system', 'Failed to access microphone. Please check permissions.');
        }
      } else {
        mediaRecorder.stop();
        micButton.textContent = 'Start Talking';
        micButton.classList.remove('active');
        micAnimation.classList.remove('active');
        isRecording = false;
      }
    });

    function appendMessage(sender, message) {
      const messageElement = document.createElement('div');
      messageElement.classList.add('message', sender);
      const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      messageElement.innerHTML = `<strong>${sender === 'ai' ? 'Rev' : sender === 'user' ? 'You' : 'System'}:</strong> ${message}<div class="timestamp">${timestamp}</div>`;
      chatBox.appendChild(messageElement);
      chatBox.scrollTop = chatBox.scrollHeight;
    }
  </script>
</body>
</html>